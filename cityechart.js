/**
 * Created by hp on 2016/9/20.
 */
var obj = {
    "四川": {
        "chinanet1": 98.1,
        "chinanet2": 97.1,
        "chinanet3": 96.2,
        "chinamobile1": 98.1,
        "chinamobile2": 97.1,
        "chinamobile3": 96.2,
        "chinaunicom1": 95.1,
        "chinaunicom2": 94.1,
        "chinaunicom3": 93.2
    },
    "成都": {
        "chinanet1": 98.2,
        "chinanet2": 97.1,
        "chinanet3": 96.2,
        "chinamobile1": 98.1,
        "chinamobile2": 97.1,
        "chinamobile3": 96.2,
        "chinaunicom1": 95.1,
        "chinaunicom2": 94.1,
        "chinaunicom3": 93.2
    },
    "自贡": {
        "chinanet1": 97.1,
        "chinanet2": 96.1,
        "chinanet3": 95.2,
        "chinamobile1": 94.1,
        "chinamobile2": 87.1,
        "chinamobile3": 86.2,
        "chinaunicom1": 90.1,
        "chinaunicom2": 89.1,
        "chinaunicom3": 88.2
    },
    "泸州": {
        "chinanet1": 95.1,
        "chinanet2": 94.1,
        "chinanet3": 93.2,
        "chinamobile1": 92.1,
        "chinamobile2": 89.1,
        "chinamobile3": 87.2,
        "chinaunicom1": 90.1,
        "chinaunicom2": 88.1,
        "chinaunicom3": 86.8
    },
    "德阳": {
        "chinanet1": 93.1,
        "chinanet2": 92.1,
        "chinanet3": 91.6,
        "chinamobile1": 92.5,
        "chinamobile2": 89.6,
        "chinamobile3": 88.2,
        "chinaunicom1": 92.1,
        "chinaunicom2": 91.2,
        "chinaunicom3": 90.5
    },
    "绵阳": {
        "chinanet1": 94.5,
        "chinanet2": 93.1,
        "chinanet3": 92.2,
        "chinamobile1": 90.1,
        "chinamobile2": 89.1,
        "chinamobile3": 88.2,
        "chinaunicom1": 92.1,
        "chinaunicom2": 88.9,
        "chinaunicom3": 86.2
    },
    "广元": {
        "chinanet1": 93.3,
        "chinanet2": 92.1,
        "chinanet3": 91.4,
        "chinamobile1": 92.6,
        "chinamobile2": 89.4,
        "chinamobile3": 88.6,
        "chinaunicom1": 92.2,
        "chinaunicom2": 89.8,
        "chinaunicom3": 88.9
    },
    "遂宁": {
        "chinanet1": 99.1,
        "chinanet2": 97.1,
        "chinanet3": 96.2,
        "chinamobile1": 93.1,
        "chinamobile2": 92.1,
        "chinamobile3": 90.0,
        "chinaunicom1": 92.9,
        "chinaunicom2": 88.5,
        "chinaunicom3": 86.2
    },
    "内江": {
        "chinanet1": 96.1,
        "chinanet2": 95.1,
        "chinanet3": 94.2,
        "chinamobile1": 92.1,
        "chinamobile2": 88.1,
        "chinamobile3": 87.2,
        "chinaunicom1": 89.1,
        "chinaunicom2": 88.1,
        "chinaunicom3": 87.2
    },
    "乐山": {
        "chinanet1": 94.1,
        "chinanet2": 93.1,
        "chinanet3": 92.2,
        "chinamobile1": 92.1,
        "chinamobile2": 91.1,
        "chinamobile3": 90.2,
        "chinaunicom1": 92.1,
        "chinaunicom2": 91.1,
        "chinaunicom3": 90.2
    },
    "南充": {
        "chinanet1": 99.1,
        "chinanet2": 98.1,
        "chinanet3": 97.2,
        "chinamobile1": 92.1,
        "chinamobile2": 91.1,
        "chinamobile3": 90.2,
        "chinaunicom1": 89.1,
        "chinaunicom2": 88.1,
        "chinaunicom3": 87.2
    },
    "宜宾": {
        "chinanet1": 95.1,
        "chinanet2": 94.1,
        "chinanet3": 93.2,
        "chinamobile1": 94.1,
        "chinamobile2": 93.1,
        "chinamobile3": 92.2,
        "chinaunicom1": 90.1,
        "chinaunicom2": 89.1,
        "chinaunicom3": 88.2
    },
    "广安": {
        "chinanet1": 96.1,
        "chinanet2": 95.1,
        "chinanet3": 94.2,
        "chinamobile1": 93.1,
        "chinamobile2": 92.1,
        "chinamobile3": 91.2,
        "chinaunicom1": 90.1,
        "chinaunicom2": 89.1,
        "chinaunicom3": 87.2
    },
    "达州": {
        "chinanet1": 97.1,
        "chinanet2": 91.1,
        "chinanet3": 90.2,
        "chinamobile1": 95.1,
        "chinamobile2": 89.1,
        "chinamobile3": 86.2,
        "chinaunicom1": 90.1,
        "chinaunicom2": 89.1,
        "chinaunicom3": 87.2
    },
    "眉山": {
        "chinanet1": 90.1,
        "chinanet2": 89.1,
        "chinanet3": 88.2,
        "chinamobile1": 93.1,
        "chinamobile2": 89.1,
        "chinamobile3": 86.2,
        "chinaunicom1": 90.1,
        "chinaunicom2": 89.1,
        "chinaunicom3": 86.2
    },
    "雅安": {
        "chinanet1": 89.1,
        "chinanet2": 88.1,
        "chinanet3": 87.2,
        "chinamobile1": 94.1,
        "chinamobile2": 87.1,
        "chinamobile3": 86.2,
        "chinaunicom1": 89.9,
        "chinaunicom2": 89.0,
        "chinaunicom3": 88.2
    },
    "巴中": {
        "chinanet1": 97.1,
        "chinanet2": 96.1,
        "chinanet3": 95.2,
        "chinamobile1": 92.1,
        "chinamobile2": 91.1,
        "chinamobile3": 90.2,
        "chinaunicom1": 90.1,
        "chinaunicom2": 89.1,
        "chinaunicom3": 87.2
    },
    "资阳": {
        "chinanet1": 97.1,
        "chinanet2": 96.1,
        "chinanet3": 95.2,
        "chinamobile1": 90.1,
        "chinamobile2": 87.1,
        "chinamobile3": 86.2,
        "chinaunicom1": 90.1,
        "chinaunicom2": 89.1,
        "chinaunicom3": 88.2
    },
    "阿坝": {
        "chinanet1": 97.1,
        "chinanet2": 95.1,
        "chinanet3": 92.2,
        "chinamobile1": 94.1,
        "chinamobile2": 89.1,
        "chinamobile3": 86.2,
        "chinaunicom1": 90.1,
        "chinaunicom2": 89.1,
        "chinaunicom3": 87.2
    },
    "甘孜": {
        "chinanet1": 99.1,
        "chinanet2": 92.1,
        "chinanet3": 90.2,
        "chinamobile1": 94.1,
        "chinamobile2": 87.1,
        "chinamobile3": 86.2,
        "chinaunicom1": 90.1,
        "chinaunicom2": 88.9,
        "chinaunicom3": 88.2
    },
    "凉山": {
        "chinanet1": 97.1,
        "chinanet2": 96.1,
        "chinanet3": 93.2,
        "chinamobile1": 94.1,
        "chinamobile2": 87.1,
        "chinamobile3": 86.2,
        "chinaunicom1": 90.1,
        "chinaunicom2": 89.1,
        "chinaunicom3": 88.2
    },
    "攀枝花": {
        "chinanet1": 97.1,
        "chinanet2": 96.1,
        "chinanet3": 90.2,
        "chinamobile1": 94.1,
        "chinamobile2": 87.1,
        "chinamobile3": 86.2,
        "chinaunicom1": 90.1,
        "chinaunicom2": 89.1,
        "chinaunicom3": 88.2
    },
};
var curCategories = [];
var curFirstChinaNet = [];
var curSecondChinaNet = [];
var curThirdChinaNet = [];
var curChinaMobile = [];
$(function () {
    function initcharts() {
        initData();
        $('#container').highcharts({
            exporting: {
                enabled: false
            },
            chart: {
                type: 'column'
            },
            title: {
                text: null
            },
            credits: {
                enabled: false,
                text: 'tydic.com',
                href: 'http://www.tydic.com'
            },
            xAxis: [{
                categories: curCategories
            }],
            yAxis: [{
                min: 85,
                max: 100,
                title: {
                    text: '覆盖率'
                }
            }],
            legend: {
                shadow: false
            },
            tooltip: {
                shared: true
            },
            plotOptions: {
                column: {
                    grouping: false,
                    shadow: false,
                    borderWidth: 0
                }
            },
            series: [{
                name: '电信-105dBm',
                color:'#FFFF01',
                data: curFirstChinaNet,
                events: {
                    click: function (data) {
                        showCity(data.point.category);
                    }
                }
            }, {
                name: '电信-100dBm',
                color:'#79D4FF',
                data: curSecondChinaNet,
                events: {
                    click: function (data) {
                        showCity(data.point.category);
                    }
                }
            }, {
                name: '电信-95dBm',
                color:'#00AEFF',
                data: curThirdChinaNet,
                events: {
                    click: function (data) {
                        showCity(data.point.category);
                    }
                }
            }, {
                name: '移动-105dBm',
                data: curChinaMobile,
                color:'#FFFF01',
                events: {
                    click: function (data) {
                        showCity(data.point.category);
                    }
                },
                pointPadding: 0.4,
                pointPlacement: 0
            },]
        });
    }

    function showCity(data) {
        $('#container1').highcharts({
            exporting: {
                enabled: false
            },
            chart: {
                polar: false,
                type: 'line'
            },
            credits: {
                enabled: false
            },

            title: {
                text: data + '三大运营商对比图',
                x: -80
            },
            pane: {
                size: '80%'
            },
            xAxis: {
                categories: ['-85dbm以上', '-90dbm', '-95dbm', '-100dbm', '-105dbm', '-110dbm以下'],
                tickmarkPlacement: 'on',
                lineWidth: 0
            },
            yAxis: {
                title: {
                    text: '覆盖率'
                },
                gridLineInterpolation: 'polygon',
                lineWidth: 0,
                min: 0,
                max: 100
            },
            tooltip: {
                shared: true,
                pointFormat: '<span style="color:{series.color}">{series.name}: <b>{point.y}%</b><br/>'
            },
            legend: {
                align: 'center',
                verticalAlign: 'bottom',
                layout: 'horizontal'
            },
            series: [{
                name: '电信覆盖率',
                data: [20.2, 30.2, 50.3, 62.3, 71.2, 90.4],
                color: '#7CB5EC',
                pointPlacement: 'on'
            }, {
                name: '移动覆盖率',
                data: [10.2, 33.2, 44.3, 66.3, 82.2, 93.4],
                color: '#F7A35C',
                pointPlacement: 'on'
            }, {
                name: '联通覆盖率',
                data: [15.2, 26.2, 33.3, 69.3, 77.2, 83.4],
                color: '#8a6d3b',
                pointPlacement: 'on'
            }]
        });
    }


    /**
     * 将全局变量中保持和选中项一致
     * @returns {Array}
     */
    function initData() {
        // 删除全局变量原有的数据，再向其中push
        curCategories.splice(0, curCategories.length);
        curFirstChinaNet.splice(0, curFirstChinaNet.length);
        curSecondChinaNet.splice(0, curSecondChinaNet.length);
        curThirdChinaNet.splice(0, curThirdChinaNet.length);
        curChinaMobile.splice(0, curChinaMobile.length);
        var categories = $('#tool').find('text');
        for (var i = 0, j = categories.length; i < j; i++) {
            if ($(categories[i]).is('.texton')) {
                var str = $(categories[i]).html().replace(/[\r\n ]/g, "");
                curCategories.push(str);
            }
        }

        for (var i = 0, j = curCategories.length; i < j; i++) {
            curFirstChinaNet.push(parseFloat(obj[curCategories[i]].chinanet1));
            curSecondChinaNet.push(parseFloat(obj[curCategories[i]].chinanet2));
            curThirdChinaNet.push(parseFloat(obj[curCategories[i]].chinanet3));
            curChinaMobile.push(parseFloat(obj[curCategories[i]].chinamobile1));
        }
        // console.log(curFirstChinaNet);
        // console.log(curSecondChinaNet);
        // console.log(curThirdChinaNet);
        // console.log(curChinaMobile);
    }

    $('#tool').find('.highcharts-legend-item').click(function () {
        var chart = $('#container').highcharts();
        if ($(this).find('rect').is('.on')) {
            $(this).find('rect').removeClass('on').addClass('off');
            $(this).find('text').removeClass('texton').addClass('textoff');
            initcharts();
        } else {
            $(this).find('rect').removeClass('off').addClass('on');
            $(this).find('text').removeClass('textoff').addClass('texton');
            initcharts();
        }
    })
    initcharts();
})